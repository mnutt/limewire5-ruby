<project default="jar">

	<!-- Compile and package LimeWire's 4.18.8 source code into LimeWire.jar -->

	<target name="clean" description="Clean temporary files to compile everything from scratch">

		<!-- Delete our temporary folders -->
		<delete dir="build"/>
		<delete dir="deploy"/>
	</target>

	<target name="jar" description="Compile and package LimeWire's source code into LimeWire.jar">

		<!-- Make folders for files this script will create -->
		<mkdir dir="build"/>
		<mkdir dir="deploy"/>

		<!-- Bring in resource files so they'll get bundled into the .jar file we'll make -->
		<copy todir="build">

			<!-- Paths to folders that each have a tree of image and text files in them -->
			<fileset dir="components/common/src/main/resources"/>
			<fileset dir="components/resources/src/main/resources"/>
			<fileset dir="private-components/swingui/src/main/resources"/>
		</copy>

		<!--
		Compile all the .java files into .class files

		fork = yes         Run the compiler in a separate process
		memoryinitialzie   Give the compiler more memory than the default
		memorymaximumsize
		debug = yes        Include debug information in the .class files
		destdir            Where to put the .class files
		excludes           Don't take the .java files in the windows and macosx folders
		                   These were compiled on those platforms separately and put in ProgressTabs.jar
		source and target  Use Java version 1.5
		-->
		<javac
			fork="yes"
			memoryinitialsize="256m"
			memorymaximumsize="256m"
			debug="yes"
			destdir="build"
			excludes="macosx/**,windows/**"
			source="1.6"
			target="1.6">

			<!-- Compile the code in these folders, each has a tree of .java files in it -->
			<src path="core"/>
			<src path="private-components/integrated-ui/src/main/java"/>
			<src path="private-components/swingui/src/main/java"/>
			<src path="private-components/mock-core/src/main/java"/>

			<src path="components/collection/src/main/java"/>
			<src path="components/common/src/main/java"/>
			<src path="components/core-api/src/main/java"/>
			<src path="components/core-glue/src/main/java"/>

			<src path="components/core-settings/src/main/java"/>
			<!-- skip  components/CVS -->
			<src path="components/geocode/src/main/java"/>
			<src path="components/http/src/main/java"/>

			<src path="components/io/src/main/java"/>
			<src path="components/lwsserver/src/main/java"/>
			<src path="components/mojito/src/main/java"/>
			<src path="components/mojito-ui/src/main/java"/>

			<src path="components/net/src/main/java"/>
			<src path="components/nio/src/main/java"/>
			<src path="components/player/src/main/java"/>
			<src path="components/player-api/src/main/java"/>

			<src path="components/promotion/src/main/java"/>
			<!-- skip  components/resources -->
			<src path="components/rudp/src/main/java"/>
			<src path="components/security/src/main/java"/>

			<src path="components/setting/src/main/java"/>
			<src path="components/statistic/src/main/java"/>
			<src path="components/swarm/src/main/java"/>
			<src path="components/xmpp/src/main/java"/>

			<src path="components/xmpp-api/src/main/java"/>
			<!-- skip  components/test-util -->

			<!-- Tell the Java compiler where .jar files are that the code above uses -->
			<classpath>

				<!-- Paths to all the .jar files in lib/jars and subfolders, but not lib/jars/tests -->
				<fileset dir="lib/jars">
				  <include name="**/*.jar"/>
				</fileset>

			</classpath>
		</javac>

		<!-- Class path list for the jar file -->
		<path id="jar.classpath">
			<pathelement location="aopalliance.jar"/>
			<pathelement location="AppFramework.jar"/>
			<pathelement location="base64-2.2.2.jar"/>
			<pathelement location="bsf.jar"/>
			<pathelement location="clink.jar"/>
			<pathelement location="commons-codec-1.3.jar"/>
			<pathelement location="commons-logging.jar"/>
			<pathelement location="commons-math-1.2.jar"/>
			<pathelement location="cocoaFoundation.jar"/>
			<pathelement location="daap.jar"/>
			<pathelement location="dnsjava-2.0.6.jar"/>
			<pathelement location="EventBus-1.2b.jar"/>
			<pathelement location="forms.jar"/>
			<pathelement location="foxtrot.jar"/>
		        <pathelement location="gettext-ant-tasks.jar"/>
			<pathelement location="gettext-commons.jar"/>
			<pathelement location="glazedlists-1.7.0_java15.jar"/>
			<pathelement location="guice-assistedinject-snapshot.jar"/>
			<pathelement location="guice-snapshot.jar"/>
			<pathelement location="hsqldb.jar"/>
			<pathelement location="httpclient-4.0-beta1.jar"/>
			<pathelement location="httpcore-4.0-beta2.jar"/>
			<pathelement location="httpcore-nio-4.0-beta2.jar"/>
			<pathelement location="icu4j.jar"/>
			<pathelement location="jaudiotagger.jar"/>
			<pathelement location="jcip-annotations.jar"/>
			<pathelement location="jcraft.jar"/>
			<pathelement location="jdic.jar"/>
			<pathelement location="jlac.jar"/>
			<pathelement location="jl.jar"/>
			<pathelement location="jmdns.jar"/>
			<pathelement location="jna.jar"/>
			<pathelement location="jogg.jar"/>
			<pathelement location="jorbis.jar"/>
			<pathelement location="jruby-engine.jar"/>
			<pathelement location="jruby-rack-0.9.3.jar"/>
			<pathelement location="jruby.jar"/>
			<pathelement location="jxlayer.jar"/>
			<pathelement location="log4j.jar"/>
			<pathelement location="looks.jar"/>
			<pathelement location="messages.jar"/>
			<pathelement location="miglayout.jar"/>
			<pathelement location="mozdom4java.jar"/>
			<pathelement location="MozillaGlue-1.9.jar"/>
			<pathelement location="MozillaInterfaces-1.9.jar"/>
			<pathelement location="mozswing.jar"/>
			<pathelement location="mp3spi.jar"/>
			<pathelement location="onion-common.jar"/>
			<pathelement location="onion-fec.jar"/>
			<pathelement location="ProgressTabs.jar"/>
			<pathelement location="smack.jar"/>
			<pathelement location="smackx-debug.jar"/>
			<pathelement location="smackx.jar"/>
			<pathelement location="swing-worker-1.1.jar"/>
			<pathelement location="swingx-0.9.4.jar"/>
			<pathelement location="tritonus.jar"/>
			<pathelement location="vorbisspi.jar"/>
		</path>

		<!-- Convert project class path to string property -->
		<pathconvert property="mf.classpath" pathsep=" ">
		        <path refid="jar.classpath" />
			<flattenmapper />
		</pathconvert>


		<!--
		Bundle resource files and .class files together to make LimeWire.jar

		jarfile          Where to make the .jar file, this will overwrite a file already there
		basedir          Find the files to put in the jar here
		filesonly = yes  Store only file entries
		compress = no    Don't compress the contents
		-->
		<jar
			jarfile="deploy/LimeWire.jar"
			basedir="build"
			filesonly="yes"
			compress="no">

			<!-- Add all 33 cross-platform jars to the classpath -->
			<manifest>
				<attribute name="Class-Path" value="${mf.classpath}"/>
			</manifest>
		</jar>
	</target>

	<!-- Make empty jars with just a main class and classpath in the manifest, adding LimeWire.jar and the platform-specific jars -->

	<target name="launch" description="Make platform-specific launch jars">
		<jar jarfile="deploy/launch-mac.jar">
			<manifest>
				<attribute name="Main-Class" value="org.limewire.ui.swing.Main"/>
				<attribute name="Class-Path" value="LimeWire.jar mac-MRJAdapter.jar"/>
			</manifest>
		</jar>
		<jar jarfile="deploy/launch-win.jar">
			<manifest>
				<attribute name="Main-Class" value="org.limewire.ui.swing.Main"/>
				<attribute name="Class-Path" value="LimeWire.jar win-jdic_stub.jar win-jacob-1.14.1.jar win-iTunes-0.0.1.jar"/>
			</manifest>
		</jar>
		<jar jarfile="deploy/launch-linux.jar">
			<manifest>
				<attribute name="Main-Class" value="org.limewire.ui.swing.Main"/>
				<attribute name="Class-Path" value="LimeWire.jar linux-jdic_stub.jar"/>
			</manifest>
		</jar>
	</target>
</project>
