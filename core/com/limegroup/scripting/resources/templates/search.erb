<html>
  <head>
    <title>Limewire Search</title>
    <script src="/script/asset/jquery.js" type="text/javascript"></script> 
    <script src="/script/asset/jquery-ui-tabs.js" type="text/javascript"></script>
    <link rel="stylesheet" href="http://dev.jquery.com/view/tags/ui/latest/themes/flora/flora.all.css" type="text/css" media="screen" title="Flora (Default)">
    <style type="text/css">
      .ui-tabs-hide { display: none; }
    </style>
    <script>
      $(document).ready(function(){
        $("#search_text").keyup(function(e) {
          if(e.keyCode == 13) {
            new_search();
          }
        });
        $("#search_results > ul").tabs();

      });


    </script>
    <script>
      var tabs = [];
      var idx = 0;

      function insert_results(results) {
        
        if(results == undefined)
          return;

      }

      function update_tabs() {
        for(var i = 0; i < $(tabs).size(); i++) {
	  $.getJSON("/script/search_results?guid=" + tabs[i][1], function(data) {
	    insert_results(data);
	  });
	}
      }

      function new_tab(query, guid) {
        //create tab element
	var my_idx = idx++;
	var my_id = "fragment-" + my_idx;
	$("#search_results > ul").prepend("<li><a href='#"+my_id+"'><span>"+query+"</span></a></li>");
	$("#search_results > ul").after("<div id='"+my_id+"'><p>HI THERE " + query + "</p></div>");
        tabs.push(new Array(query, guid, $("#" + my_id)));
	$("#search_results > ul").tabs("destroy");
	$("#search_results > ul").tabs();


      }
      
      function new_search() {
        $.getJSON("/script/search_results?q=" + $("#search_text").val(), function(data) {
          data = $(data);
          new_tab(unescape(data.attr("q")), unescape(data.attr("guid")));
      });
      };
      

      setInterval(update_tabs, 5000);


    </script>
  </head>
  <body>

      <input type="text" id="search_text">
      <a id="search_submit" href="#" onclick="new_search()">Submit!</a>

      <div id="search_results" class="flora">
	<ul>
	</ul>
      
    </div>
  </body>
</html>
